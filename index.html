<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>YouTube Shorts Converter - Free Video to Vertical Clip Converter</title>
    <meta name="title" content="YouTube Shorts Converter - Free Video to Vertical Clip Converter">
    <meta name="description" content="100% Free online tool to convert YouTube videos and MP4 files into short vertical clips for TikTok, Instagram Reels, YouTube Shorts. No watermarks, no registration required.">
    <meta name="keywords" content="youtube shorts converter, video to vertical, tiktok maker, instagram reels, short video creator, free video converter, mp4 to vertical, youtube to tiktok, horizontal to vertical video, video editing online, free video cutter, social media video maker, ffmpeg online, video clip maker, shorts creator">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://youtube-shorts-converter.netlify.app/">
    <meta property="og:title" content="YouTube Shorts Converter - Free Video to Vertical Clip Converter">
    <meta property="og:description" content="Convert YouTube videos to short vertical clips for TikTok, Instagram Reels, YouTube Shorts - 100% Free, no watermarks">
    <meta property="og:image" content="https://youtube-shorts-converter.netlify.app/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://youtube-shorts-converter.netlify.app/">
    <meta property="twitter:title" content="YouTube Shorts Converter - Free Video to Vertical Clip Converter">
    <meta property="twitter:description" content="Convert YouTube videos to short vertical clips for TikTok, Instagram Reels, YouTube Shorts - 100% Free, no watermarks">
    <meta property="twitter:image" content="https://youtube-shorts-converter.netlify.app/og-image.jpg">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="author" content="YouTube Shorts Converter">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">
    
    <!-- Structured Data / Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "YouTube Shorts Converter",
      "url": "https://youtube-shorts-converter.netlify.app/",
      "description": "Free online tool to convert YouTube videos and MP4 files into short vertical clips for social media platforms",
      "applicationCategory": "MultimediaApplication",
      "operatingSystem": "Any",
      "permissions": "browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "YouTube Shorts Converter"
      }
    }
    </script>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://youtube-shorts-converter.netlify.app/">
    
    <style>
        :root {
            --primary: #ff0000;
            --primary-dark: #cc0000;
            --dark: #202020;
            --light: #ffffff;
            --gray: #f0f0f0;
            --dark-gray: #606060;
            --success: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }
        
        header {
            background-color: var(--dark);
            color: var(--light);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .logo-icon {
            color: var(--primary);
        }
        
        .hero {
            text-align: center;
            padding: 3rem 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            color: var(--dark-gray);
        }
        
        .converter-section {
            background-color: var(--light);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .input-group {
            display: flex;
            margin-bottom: 1.5rem;
        }
        
        .url-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--dark-gray);
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }
        
        .file-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--dark-gray);
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .url-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            background-color: var(--primary);
            color: var(--light);
            border: none;
            padding: 12px 25px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
        }
        
        .btn:disabled {
            background-color: var(--dark-gray);
            cursor: not-allowed;
        }
        
        .settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .setting-group {
            margin-bottom: 1rem;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .setting-group select, 
        .setting-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--dark-gray);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .preview-section {
            margin-bottom: 2rem;
        }
        
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .preview-card {
            width: 200px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            background-color: var(--light);
            transition: transform 0.3s;
        }
        
        .preview-card:hover {
            transform: translateY(-5px);
        }
        
        .preview-thumbnail {
            width: 100%;
            height: 350px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            font-size: 0.9rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .preview-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-thumbnail::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
        }
        
        .preview-thumbnail .clip-content {
            position: relative;
            z-index: 2;
            padding: 10px;
        }
        
        .preview-info {
            padding: 10px;
        }
        
        .preview-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .preview-duration {
            color: var(--dark-gray);
            font-size: 0.8rem;
        }
        
        .download-section {
            text-align: center;
            padding: 2rem;
            background-color: var(--gray);
            border-radius: 10px;
        }
        
        .download-btn {
            background-color: var(--success);
            color: var(--light);
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .download-btn:hover {
            background-color: #45a049;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 5px solid var(--gray);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--gray);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
        
        .status-message {
            margin-top: 1rem;
            font-weight: 600;
        }
        
        .clip-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .clip-btn {
            flex: 1;
            padding: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .preview-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .download-single-btn {
            background-color: var(--success);
            color: white;
        }
        
        .upload-section {
            background: var(--gray);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
            border: 2px dashed var(--dark-gray);
        }
        
        .upload-btn {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px 0;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            border-top: 1px solid var(--gray);
            color: var(--dark-gray);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success);
        }
        
        .notification.error {
            background-color: #f44336;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--gray);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .seo-keywords {
            background: var(--gray);
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
        }
        
        .keywords-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .keyword-category {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .keyword-category h4 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .keyword-list {
            list-style: none;
        }
        
        .keyword-list li {
            padding: 2px 0;
            font-size: 0.9rem;
            color: var(--dark-gray);
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .url-input {
                border-radius: 4px;
                margin-bottom: 10px;
            }
            
            .btn {
                border-radius: 4px;
            }
            
            .preview-card {
                width: 100%;
            }
            
            .keywords-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <span class="logo-icon">🎬</span>
                <span>YouTube Shorts Converter - 100% FREE</span>
            </div>
        </div>
    </header>
    
    <div class="container">
        <section class="hero">
            <h1>Convert Videos to Short Vertical Clips - 100% Free</h1>
            <p>Process videos directly in your browser - no server costs, completely free!</p>
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
        </section>
        
        <!-- SEO Keywords Section -->
        <section class="seo-keywords">
            <h2>Free Video Tools & Keywords</h2>
            <p>Our free online video converter supports these features and formats:</p>
            
            <div class="keywords-grid">
                <div class="keyword-category">
                    <h4>Platform Converters</h4>
                    <ul class="keyword-list">
                        <li>YouTube to TikTok</li>
                        <li>YouTube to Instagram Reels</li>
                        <li>YouTube to Shorts</li>
                        <li>MP4 to Vertical</li>
                        <li>Horizontal to Vertical</li>
                    </ul>
                </div>
                
                <div class="keyword-category">
                    <h4>Video Editing</h4>
                    <ul class="keyword-list">
                        <li>Video Cutter Online</li>
                        <li>Video Trimmer Free</li>
                        <li>Clip Maker</li>
                        <li>Short Video Creator</li>
                        <li>Video Splitter</li>
                    </ul>
                </div>
                
                <div class="keyword-category">
                    <h4>Formats & Features</h4>
                    <ul class="keyword-list">
                        <li>MP4 Converter</li>
                        <li>WebM to MP4</li>
                        <li>MOV to Vertical</li>
                        <li>AVI Converter</li>
                        <li>No Watermark</li>
                    </ul>
                </div>
                
                <div class="keyword-category">
                    <h4>Social Media Tools</h4>
                    <ul class="keyword-list">
                        <li>TikTok Video Maker</li>
                        <li>Instagram Reels Creator</li>
                        <li>YouTube Shorts Maker</li>
                        <li>Facebook Video</li>
                        <li>Social Media Video</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <div class="tabs">
            <div class="tab active" data-tab="upload">Upload Video</div>
            <div class="tab" data-tab="youtube">YouTube URL</div>
        </div>
        
        <section class="converter-section">
            <!-- Upload Tab -->
            <div class="tab-content active" id="upload-tab">
                <h2>Upload Your Video</h2>
                <p>Upload a video file to convert it into short vertical clips</p>
                
                <div class="upload-section">
                    <input type="file" id="video-file" class="file-input" accept="video/*">
                    <p>or</p>
                    <button class="upload-btn" id="browse-btn">Browse Files</button>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: var(--dark-gray);">
                        Supported formats: MP4, MOV, AVI, WebM (Max 100MB)
                    </p>
                </div>
            </div>
            
            <!-- YouTube Tab -->
            <div class="tab-content" id="youtube-tab">
                <h2>Convert from YouTube</h2>
                <p>Enter YouTube URL to get video information (Note: We cannot download YouTube videos due to terms of service)</p>
                
                <div class="input-group">
                    <input type="text" class="url-input" placeholder="Paste YouTube URL here" id="youtube-url">
                    <button class="btn" id="process-yt-btn">Get Video Info</button>
                </div>
            </div>
            
            <div class="settings">
                <div class="setting-group">
                    <label for="clip-length">Clip Length</label>
                    <select id="clip-length">
                        <option value="15">15 seconds</option>
                        <option value="30" selected>30 seconds</option>
                        <option value="60">60 seconds</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="clip-count">Number of Clips</label>
                    <select id="clip-count">
                        <option value="auto">Auto (Based on video length)</option>
                        <option value="3">3 clips</option>
                        <option value="5">5 clips</option>
                        <option value="10">10 clips</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="aspect-ratio">Aspect Ratio</label>
                    <select id="aspect-ratio">
                        <option value="9:16" selected>9:16 (Vertical)</option>
                        <option value="1:1">1:1 (Square)</option>
                        <option value="4:5">4:5 (Portrait)</option>
                    </select>
                </div>
            </div>
            
            <div class="input-group">
                <button class="btn" id="process-btn" style="border-radius: 4px; width: 100%;">Process Video</button>
            </div>
        </section>
        
        <div class="loading" id="loading-section">
            <div class="spinner"></div>
            <p id="status-message">Processing your video in browser...</p>
            <div class="progress-bar">
                <div class="progress" id="loading-progress"></div>
            </div>
        </div>
        
        <section class="preview-section" id="preview-section" style="display: none;">
            <h2>Your Generated Shorts</h2>
            <p>Clips processed directly in your browser - 100% free!</p>
            
            <div class="preview-container" id="preview-container">
                <!-- Preview clips will be generated here -->
            </div>
        </section>
        
        <section class="download-section" id="download-section" style="display: none;">
            <h2>Ready to Download</h2>
            <p>All clips processed successfully using free browser technology</p>
            <button class="download-btn" id="download-btn">Download All Clips as ZIP</button>
        </section>
    </div>
    
    <footer>
        <div class="container">
            <p><strong>YouTube Shorts Converter</strong> - Free Online Video to Vertical Clip Converter | MP4 to TikTok | YouTube to Instagram Reels | Horizontal to Vertical Video Converter Youtube video shorts converter </p>
            <p style="margin-top: 1rem; font-size: 0.9rem;">&copy; 2026 YouTube Shorts Converter. 100% Free - Processing happens in your browser</p>
        </div>
    </footer>
    
    <div class="notification" id="notification"></div>

    <!-- Load FFmpeg.wasm -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js"></script>
    
    <script>
        // Update the page title with keywords for better SEO
const keywords = ['Free Video Converter', 'YouTube to TikTok', 'MP4 to Vertical', 'Video Cutter Online'];
let currentKeywordIndex = 0;

function rotateTitle() {
    document.title = `YouTube Shorts Converter - ${keywords[currentKeywordIndex]}`;
    currentKeywordIndex = (currentKeywordIndex + 1) % keywords.length;
}

// Rotate title every 5 seconds for SEO
setInterval(rotateTitle, 5000);

document.addEventListener('DOMContentLoaded', function() {
    const processBtn = document.getElementById('process-btn');
    const videoFileInput = document.getElementById('video-file');
    const youtubeUrlInput = document.getElementById('youtube-url');
    const processYtBtn = document.getElementById('process-yt-btn');
    const loadingSection = document.getElementById('loading-section');
    const previewSection = document.getElementById('preview-section');
    const previewContainer = document.getElementById('preview-container');
    const downloadSection = document.getElementById('download-section');
    const downloadBtn = document.getElementById('download-btn');
    const statusMessage = document.getElementById('status-message');
    const loadingProgress = document.getElementById('loading-progress');
    const notification = document.getElementById('notification');
    const tabs = document.querySelectorAll('.tab');
    const browseBtn = document.getElementById('browse-btn');
    
    let ffmpeg = null;
    let isFFmpegLoading = false;
    let isFFmpegLoaded = false;
    let currentVideoFile = null;
    
    // Tab functionality
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            
            // Update tabs
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        });
    });
    
    // Browse button
    browseBtn.addEventListener('click', () => {
        videoFileInput.click();
    });
    
    // File input change
    videoFileInput.addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
            currentVideoFile = this.files[0];
            showNotification(`Selected: ${currentVideoFile.name}`, 'success');
        }
    });
    
    // Show notification
    function showNotification(message, type = 'success') {
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    }
    
    // Update progress bar
    function updateProgress(percent, message) {
        loadingProgress.style.width = `${percent}%`;
        if (message) {
            statusMessage.textContent = message;
        }
    }
    
    // Fixed FFmpeg initialization with proper loading check
    async function initFFmpeg() {
        if (isFFmpegLoaded && ffmpeg) {
            return ffmpeg;
        }
        
        if (isFFmpegLoading) {
            // Wait for existing load to complete
            while (isFFmpegLoading) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            return ffmpeg;
        }
        
        isFFmpegLoading = true;
        
        try {
            const { createFFmpeg } = FFmpeg;
            ffmpeg = createFFmpeg({ 
                log: false,
                progress: ({ ratio }) => {
                    const progress = Math.round(ratio * 100);
                    updateProgress(progress, `Loading FFmpeg... ${progress}%`);
                }
            });
            
            updateProgress(10, 'Loading FFmpeg.wasm...');
            await ffmpeg.load();
            
            isFFmpegLoaded = true;
            isFFmpegLoading = false;
            
            updateProgress(100, 'FFmpeg loaded successfully!');
            
            return ffmpeg;
            
        } catch (error) {
            isFFmpegLoading = false;
            console.error('FFmpeg load error:', error);
            throw new Error(`FFmpeg failed to load: ${error.message}`);
        }
    }
    
    // Pre-load FFmpeg when page loads
    async function preloadFFmpeg() {
        try {
            await initFFmpeg();
            console.log('FFmpeg pre-loaded successfully');
        } catch (error) {
            console.log('FFmpeg pre-load failed, will load on demand:', error.message);
        }
    }
    
    // Start pre-loading FFmpeg
    preloadFFmpeg();
    
    // Process uploaded video
    processBtn.addEventListener('click', async function() {
        if (!currentVideoFile) {
            showNotification('Please select a video file first', 'error');
            return;
        }
        
        if (currentVideoFile.size > 100 * 1024 * 1024) {
            showNotification('File too large. Please select a video under 100MB', 'error');
            return;
        }
        
        await processVideoFile(currentVideoFile);
    });
    
    // Process YouTube URL (metadata only)
    processYtBtn.addEventListener('click', function() {
        const youtubeUrl = youtubeUrlInput.value.trim();
        
        if (!youtubeUrl) {
            showNotification('Please enter a YouTube URL', 'error');
            return;
        }
        
        const videoId = extractVideoId(youtubeUrl);
        if (!videoId) {
            showNotification('Invalid YouTube URL', 'error');
            return;
        }
        
        showNotification('Note: We can only get video info. For processing, please upload a video file.', 'success');
    });
    
    // Extract YouTube video ID
    function extractVideoId(url) {
        const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[7].length === 11) ? match[7] : null;
    }
    
    // FIXED: Main video processing function with proper vertical conversion
    async function processVideoFile(file) {
        try {
            loadingSection.style.display = 'block';
            previewSection.style.display = 'none';
            downloadSection.style.display = 'none';
            processBtn.disabled = true;
            
            updateProgress(0, 'Initializing video processor...');
            
            // Ensure FFmpeg is loaded
            const ffmpegInstance = await initFFmpeg();
            
            if (!ffmpegInstance) {
                throw new Error('FFmpeg failed to initialize');
            }
            
            updateProgress(20, 'Reading video file...');
            const arrayBuffer = await file.arrayBuffer();
            const uint8Array = new Uint8Array(arrayBuffer);
            
            updateProgress(40, 'Preparing for processing...');
            ffmpegInstance.FS('writeFile', 'input.mp4', uint8Array);
            
            const clipDuration = parseInt(document.getElementById('clip-length').value);
            const aspectRatio = document.getElementById('aspect-ratio').value;
            const clipCount = 3;
            const processedClips = [];
            
            // FIXED: Proper aspect ratio conversion settings
            let scaleFilter;
            switch (aspectRatio) {
                case '9:16':
                    // True vertical 9:16 - 1080x1920
                    scaleFilter = 'scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2:black';
                    break;
                case '1:1':
                    // Square 1:1 - 1080x1080
                    scaleFilter = 'scale=1080:1080:force_original_aspect_ratio=decrease,pad=1080:1080:(ow-iw)/2:(oh-ih)/2:black';
                    break;
                case '4:5':
                    // Portrait 4:5 - 864x1080
                    scaleFilter = 'scale=864:1080:force_original_aspect_ratio=decrease,pad=864:1080:(ow-iw)/2:(oh-ih)/2:black';
                    break;
                default:
                    scaleFilter = 'scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2:black';
            }
            
            for (let i = 0; i < clipCount; i++) {
                const startTime = i * clipDuration;
                const progress = 40 + (i * 15);
                updateProgress(progress, `Converting clip ${i + 1} to ${aspectRatio}...`);
                
                try {
                    // FIXED: Simple and reliable FFmpeg command for vertical conversion
                    await ffmpegInstance.run(
                        '-i', 'input.mp4',
                        '-ss', startTime.toString(),
                        '-t', clipDuration.toString(),
                        '-vf', scaleFilter,
                        '-c:v', 'libx264',
                        '-c:a', 'aac',
                        `clip-${i + 1}.mp4`
                    );
                    
                    const data = ffmpegInstance.FS('readFile', `clip-${i + 1}.mp4`);
                    
                    if (data.length === 0) {
                        throw new Error('Empty clip generated');
                    }
                    
                    const blob = new Blob([data.buffer], { type: 'video/mp4' });
                    const url = URL.createObjectURL(blob);
                    
                    processedClips.push({
                        id: i + 1,
                        title: `Clip ${i + 1}`,
                        duration: `${clipDuration}s`,
                        aspect: aspectRatio,
                        url: url,
                        blob: blob
                    });
                    
                } catch (error) {
                    console.warn(`Failed to process clip ${i + 1}:`, error);
                    // Continue with other clips
                }
            }
            
            if (processedClips.length === 0) {
                throw new Error('No clips were successfully processed');
            }
            
            updateProgress(100, 'Finalizing clips...');
            displayProcessedClips(processedClips);
            
            loadingSection.style.display = 'none';
            previewSection.style.display = 'block';
            downloadSection.style.display = 'block';
            processBtn.disabled = false;
            
            showNotification(`✅ Success! Converted ${processedClips.length} clips to ${aspectRatio}`, 'success');
            
        } catch (error) {
            console.error('Video processing error:', error);
            loadingSection.style.display = 'none';
            processBtn.disabled = false;
            
            if (error.message.includes('not ready') || error.message.includes('load')) {
                showNotification('Video processor is still loading. Please wait a moment and try again.', 'error');
            } else {
                showNotification('Processing failed: ' + error.message, 'error');
            }
        }
    }
    
    // Display processed clips
    function displayProcessedClips(clips) {
        previewContainer.innerHTML = '';
        
        clips.forEach(clip => {
            const clipElement = document.createElement('div');
            clipElement.className = 'preview-card';
            clipElement.innerHTML = `
                <div class="preview-thumbnail">
                    <video controls style="width: 100%; height: 100%; object-fit: cover;">
                        <source src="${clip.url}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="clip-content" style="position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 5px; border-radius: 3px; color: white; font-size: 12px;">
                        ${clip.aspect} • ${clip.duration}
                    </div>
                </div>
                <div class="preview-info">
                    <div class="preview-title">${clip.title}</div>
                    <div class="preview-duration">${clip.aspect} • ${clip.duration}</div>
                    <div class="clip-actions">
                        <button class="clip-btn preview-btn" onclick="playClip('${clip.url}')">Play</button>
                        <button class="clip-btn download-single-btn" onclick="downloadClip('${clip.url}', 'clip-${clip.id}-${clip.aspect.replace(':', 'x')}.mp4')">Download</button>
                    </div>
                </div>
            `;
            previewContainer.appendChild(clipElement);
        });
    }
    
    // Download all clips
    downloadBtn.addEventListener('click', function() {
        showNotification('Preparing ZIP download...');
        setTimeout(() => {
            showNotification('ZIP download would start here with real implementation');
        }, 1000);
    });
    
    // Global functions for button clicks
    window.playClip = function(url) {
        // Already handled by video controls
    };
    
    window.downloadClip = function(url, filename) {
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        showNotification(`✅ Downloaded: ${filename}`);
    };
});
    </script>
</body>
</html>